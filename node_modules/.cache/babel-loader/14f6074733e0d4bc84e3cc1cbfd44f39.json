{"ast":null,"code":"import _slicedToArray from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectDestructuringEmpty from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/objectDestructuringEmpty\";import React,{useEffect,useRef,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{sendMessages,startMessagesListening,stopMessagesListening}from'../../redux/chat-reducer';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChatPage=function ChatPage(){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Chat,{})});};var Chat=function Chat(){var dispatch=useDispatch();var status=useSelector(function(state){return state.chat.status;});useEffect(function(){dispatch(startMessagesListening());return function(){dispatch(stopMessagesListening());};},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[status==='error'&&/*#__PURE__*/_jsx(\"div\",{children:\"Some error occured. Please refresh the page\"}),/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Messages,{}),/*#__PURE__*/_jsx(AddMessageForm,{})]})]});};var Messages=function Messages(_ref){_objectDestructuringEmpty(_ref);var messages=useSelector(function(state){return state.chat.messages;});var messagesAnchorRef=useRef(null);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isAutoScroll=_useState2[0],setIsAutoScroll=_useState2[1];var scrollHandler=function scrollHandler(e){var element=e.currentTarget;if(Math.abs(element.scrollHeight-element.scrollTop-element.clientHeight)<300){!isAutoScroll&&setIsAutoScroll(true);}else{isAutoScroll&&setIsAutoScroll(false);}};useEffect(function(){if(isAutoScroll){var _messagesAnchorRef$cu;(_messagesAnchorRef$cu=messagesAnchorRef.current)===null||_messagesAnchorRef$cu===void 0?void 0:_messagesAnchorRef$cu.scrollIntoView({behavior:'smooth'});}},[messages]);return/*#__PURE__*/_jsxs(\"div\",{style:{height:'400px',overflowY:'auto'},onScroll:scrollHandler,children:[messages.map(function(m,index){return/*#__PURE__*/_jsx(Message,{message:m},m.id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesAnchorRef})]});};var Message=/*#__PURE__*/React.memo(function(_ref2){var message=_ref2.message;console.log(\">>>>>>Message\");return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:message.photo,style:{width:'30px'}}),\" \",/*#__PURE__*/_jsx(\"b\",{children:message.userName}),/*#__PURE__*/_jsx(\"br\",{}),message.message,/*#__PURE__*/_jsx(\"hr\",{})]});});var AddMessageForm=function AddMessageForm(){var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),message=_useState4[0],setMessage=_useState4[1];var dispatch=useDispatch();var status=useSelector(function(state){return state.chat.status;});var sendMessageHandler=function sendMessageHandler(){if(!message){return;}dispatch(sendMessages(message));setMessage('');};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"textarea\",{onChange:function onChange(e){return setMessage(e.currentTarget.value);},value:message})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{disabled:status!=='ready',onClick:sendMessageHandler,children:\"Send\"})})]});};export default ChatPage;","map":{"version":3,"sources":["D:/REact/01_first/interview/src/Pages/Chat/ChatPage.tsx"],"names":["React","useEffect","useRef","useState","useDispatch","useSelector","sendMessages","startMessagesListening","stopMessagesListening","ChatPage","Chat","dispatch","status","state","chat","Messages","messages","messagesAnchorRef","isAutoScroll","setIsAutoScroll","scrollHandler","e","element","currentTarget","Math","abs","scrollHeight","scrollTop","clientHeight","current","scrollIntoView","behavior","height","overflowY","map","m","index","id","Message","memo","message","console","log","photo","width","userName","AddMessageForm","setMessage","sendMessageHandler","value"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from 'react'\r\nimport {ChatMessageAPIType} from '../../api/chat-api'\r\nimport {useDispatch, useSelector} from 'react-redux'\r\nimport {sendMessages, startMessagesListening, stopMessagesListening} from '../../redux/chat-reducer'\r\nimport {AppStateType} from '../../redux/redux-store'\r\n\r\n\r\nconst ChatPage: React.FC = () => {\r\n    return <div>\r\n        <Chat/>\r\n    </div>\r\n}\r\n\r\nconst Chat: React.FC = () => {\r\n\r\n    const dispatch = useDispatch()\r\n\r\n\r\n    const status = useSelector((state: AppStateType) => state.chat.status)\r\n\r\n    useEffect(() => {\r\n        dispatch(startMessagesListening())\r\n        return () => {\r\n            dispatch(stopMessagesListening())\r\n        }\r\n    }, [])\r\n\r\n    return <div>\r\n        {status === 'error' && <div>Some error occured. Please refresh the page</div>}\r\n        <>\r\n            <Messages/>\r\n            <AddMessageForm/>\r\n        </>\r\n    </div>\r\n}\r\n\r\nconst Messages: React.FC<{}> = ({}) => {\r\n    const messages = useSelector((state: AppStateType) => state.chat.messages)\r\n    const messagesAnchorRef = useRef<HTMLDivElement>(null);\r\n    const [isAutoScroll, setIsAutoScroll] = useState(true)\r\n\r\n    const scrollHandler = (e: React.UIEvent<HTMLDivElement, UIEvent>) => {\r\n        const element = e.currentTarget;\r\n        if (Math.abs( (element.scrollHeight - element.scrollTop) - element.clientHeight ) < 300)\r\n        {\r\n            !isAutoScroll && setIsAutoScroll(true)\r\n        } else {\r\n            isAutoScroll && setIsAutoScroll(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (isAutoScroll) {\r\n            messagesAnchorRef.current?.scrollIntoView({behavior: 'smooth'})\r\n        }\r\n    }, [messages])\r\n\r\n    return <div style={{height: '400px', overflowY: 'auto'}} onScroll={scrollHandler}>\r\n        {messages.map((m, index) => <Message key={m.id} message={m}/>)}\r\n        <div ref={messagesAnchorRef}></div>\r\n    </div>\r\n}\r\n\r\n\r\nconst Message: React.FC<{ message: ChatMessageAPIType }> = React.memo( ({message}) => {\r\n    console.log(\">>>>>>Message\")\r\n    return <div>\r\n        <img src={message.photo} style={{width: '30px'}}/> <b>{message.userName}</b>\r\n        <br/>\r\n        {message.message}\r\n        <hr/>\r\n    </div>\r\n})\r\n\r\n\r\nconst AddMessageForm: React.FC<{}> = () => {\r\n    const [message, setMessage] = useState('')\r\n    const dispatch = useDispatch()\r\n\r\n    const status = useSelector((state: AppStateType) => state.chat.status)\r\n\r\n\r\n    const sendMessageHandler = () => {\r\n        if (!message) {\r\n            return\r\n        }\r\n        dispatch(sendMessages(message))\r\n        setMessage('')\r\n    }\r\n\r\n    return <div>\r\n        <div>\r\n            <textarea onChange={(e) => setMessage(e.currentTarget.value)} value={message}></textarea>\r\n        </div>\r\n        <div>\r\n            <button disabled={status !== 'ready'} onClick={sendMessageHandler}>Send</button>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default ChatPage\r\n"]},"metadata":{},"sourceType":"module"}