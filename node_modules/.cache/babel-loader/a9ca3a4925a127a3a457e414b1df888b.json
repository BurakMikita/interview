{"ast":null,"code":"import _regeneratorRuntime from\"D:/REact/01_first/interview/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{updateObjectInArray}from\"../utils/object-helpers\";import{usersAPI}from'../api/users-api';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[],//array of users ids\nfilter:{term:'',friend:null}};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'SN/USERS/FOLLOW':return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:true})});case'SN/USERS/UNFOLLOW':return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,\"id\",{followed:false})});case'SN/USERS/SET_USERS':{return _objectSpread(_objectSpread({},state),{},{users:action.users});}case'SN/USERS/SET_CURRENT_PAGE':{return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});}case'SN/USERS/SET_TOTAL_USERS_COUNT':{return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.count});}case'SN/USERS/TOGGLE_IS_FETCHING':{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case'SN/USERS/SET_FILTER':{return _objectSpread(_objectSpread({},state),{},{filter:action.payload});}case'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS':{return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});}default:return state;}};export var actions={followSuccess:function followSuccess(userId){return{type:'SN/USERS/FOLLOW',userId:userId};},unfollowSuccess:function unfollowSuccess(userId){return{type:'SN/USERS/UNFOLLOW',userId:userId};},setUsers:function setUsers(users){return{type:'SN/USERS/SET_USERS',users:users};},setCurrentPage:function setCurrentPage(currentPage){return{type:'SN/USERS/SET_CURRENT_PAGE',currentPage:currentPage};},setFilter:function setFilter(filter){return{type:'SN/USERS/SET_FILTER',payload:filter};},setTotalUsersCount:function setTotalUsersCount(totalUsersCount){return{type:'SN/USERS/SET_TOTAL_USERS_COUNT',count:totalUsersCount};},toggleIsFetching:function toggleIsFetching(isFetching){return{type:'SN/USERS/TOGGLE_IS_FETCHING',isFetching:isFetching};},toggleFollowingProgress:function toggleFollowingProgress(isFetching,userId){return{type:'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS',isFetching:isFetching,userId:userId};}};export var requestUsers=function requestUsers(page,pageSize,filter){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(actions.toggleIsFetching(true));dispatch(actions.setCurrentPage(page));dispatch(actions.setFilter(filter));_context.next=5;return usersAPI.getUsers(page,pageSize,filter.term,filter.friend);case 5:data=_context.sent;dispatch(actions.toggleIsFetching(false));dispatch(actions.setUsers(data.items));dispatch(actions.setTotalUsersCount(data.totalCount));case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();};var _followUnfollowFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(actions.toggleFollowingProgress(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.resultCode===0){dispatch(actionCreator(userId));}dispatch(actions.toggleFollowingProgress(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function _followUnfollowFlow(_x3,_x4,_x5,_x6){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _followUnfollowFlow(dispatch,userId,usersAPI.follow.bind(usersAPI),actions.followSuccess);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x7){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _followUnfollowFlow(dispatch,userId,usersAPI.unfollow.bind(usersAPI),actions.unfollowSuccess);case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x8){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["D:/REact/01_first/interview/src/redux/users-reducer.ts"],"names":["updateObjectInArray","usersAPI","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","filter","term","friend","usersReducer","state","action","type","userId","followed","count","payload","id","actions","followSuccess","unfollowSuccess","setUsers","setCurrentPage","setFilter","setTotalUsersCount","toggleIsFetching","toggleFollowingProgress","requestUsers","page","dispatch","getState","getUsers","data","items","totalCount","_followUnfollowFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import {updateObjectInArray} from \"../utils/object-helpers\";\r\nimport {UserType} from '../Types/types';\r\nimport {BaseThunkType, InferActionsTypes} from './redux-store';\r\nimport {Dispatch} from 'redux';\r\nimport {usersAPI} from '../api/users-api';\r\nimport {APIResponseType} from \"../api/api\";\r\n\r\nlet initialState = {\r\n    users: [] as Array<UserType>,\r\n    pageSize: 10,\r\n    totalUsersCount: 0,\r\n    currentPage: 1,\r\n    isFetching: true,\r\n    followingInProgress: [] as Array<number>, //array of users ids\r\n    filter: {\r\n        term: '',\r\n        friend: null as null | boolean\r\n    }\r\n};\r\n\r\nconst usersReducer = (state = initialState, action: ActionsTypes): InitialState => {\r\n    switch (action.type) {\r\n        case 'SN/USERS/FOLLOW':\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, \"id\", {followed: true})\r\n            }\r\n        case 'SN/USERS/UNFOLLOW':\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, \"id\", {followed: false})\r\n            }\r\n        case 'SN/USERS/SET_USERS': {\r\n            return {...state, users: action.users}\r\n        }\r\n        case 'SN/USERS/SET_CURRENT_PAGE': {\r\n            return {...state, currentPage: action.currentPage}\r\n        }\r\n        case 'SN/USERS/SET_TOTAL_USERS_COUNT': {\r\n            return {...state, totalUsersCount: action.count}\r\n        }\r\n        case 'SN/USERS/TOGGLE_IS_FETCHING': {\r\n            return {...state, isFetching: action.isFetching}\r\n        }\r\n        case 'SN/USERS/SET_FILTER': {\r\n            return {...state, filter: action.payload}\r\n        }\r\n        case 'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS': {\r\n            return {\r\n                ...state,\r\n                followingInProgress: action.isFetching\r\n                    ? [...state.followingInProgress, action.userId]\r\n                    : state.followingInProgress.filter(id => id != action.userId)\r\n            }\r\n        }\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport const actions = {\r\n    followSuccess: (userId: number) => ({type: 'SN/USERS/FOLLOW', userId} as const),\r\n    unfollowSuccess: (userId: number) => ({type: 'SN/USERS/UNFOLLOW', userId} as const),\r\n    setUsers: (users: Array<UserType>) => ({type: 'SN/USERS/SET_USERS', users} as const),\r\n    setCurrentPage: (currentPage: number) => ({type: 'SN/USERS/SET_CURRENT_PAGE', currentPage} as const),\r\n    setFilter: (filter:FilterType) => ({type: 'SN/USERS/SET_FILTER', payload: filter } as const),\r\n    setTotalUsersCount: (totalUsersCount: number) => ({\r\n        type: 'SN/USERS/SET_TOTAL_USERS_COUNT',\r\n        count: totalUsersCount\r\n    } as const),\r\n    toggleIsFetching: (isFetching: boolean) => ({\r\n        type: 'SN/USERS/TOGGLE_IS_FETCHING',\r\n        isFetching\r\n    } as const),\r\n    toggleFollowingProgress: (isFetching: boolean, userId: number) => ({\r\n        type: 'SN/USERS/TOGGLE_IS_FOLLOWING_PROGRESS',\r\n        isFetching,\r\n        userId\r\n    } as const)\r\n}\r\n\r\nexport const requestUsers = (page: number,\r\n                             pageSize: number, filter:FilterType): ThunkType => {\r\n    return async (dispatch, getState) => {\r\n        dispatch(actions.toggleIsFetching(true));\r\n        dispatch(actions.setCurrentPage(page));\r\n        dispatch(actions.setFilter(filter));\r\n\r\n\r\n        let data = await usersAPI.getUsers(page, pageSize, filter.term, filter.friend);\r\n        dispatch(actions.toggleIsFetching(false));\r\n        dispatch(actions.setUsers(data.items));\r\n        dispatch(actions.setTotalUsersCount(data.totalCount));\r\n    }\r\n}\r\n\r\nconst _followUnfollowFlow = async (dispatch: Dispatch<ActionsTypes>,\r\n                                   userId: number,\r\n                                   apiMethod: (userId:number)=> Promise<APIResponseType>, actionCreator: (userId: number) => ActionsTypes) => {\r\n    dispatch(actions.toggleFollowingProgress(true, userId));\r\n    let response = await apiMethod(userId);\r\n\r\n    if (response.resultCode === 0) {\r\n        dispatch(actionCreator(userId));\r\n    }\r\n    dispatch(actions.toggleFollowingProgress(false, userId));\r\n}\r\n\r\nexport const follow = (userId: number): ThunkType => {\r\n    return async (dispatch) => {\r\n      await  _followUnfollowFlow(dispatch, userId, usersAPI.follow.bind(usersAPI), actions.followSuccess);\r\n    }\r\n}\r\n\r\nexport const unfollow = (userId: number): ThunkType => {\r\n    return async (dispatch) => {\r\n      await  _followUnfollowFlow(dispatch, userId, usersAPI.unfollow.bind(usersAPI), actions.unfollowSuccess);\r\n    }\r\n}\r\n\r\nexport default usersReducer;\r\n\r\nexport type InitialState = typeof initialState;\r\nexport type FilterType = typeof initialState.filter;\r\n\r\ntype ActionsTypes = InferActionsTypes<typeof actions>\r\ntype ThunkType = BaseThunkType<ActionsTypes>\r\n"]},"metadata":{},"sourceType":"module"}