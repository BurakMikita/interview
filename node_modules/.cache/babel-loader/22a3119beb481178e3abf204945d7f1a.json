{"ast":null,"code":"import _regeneratorRuntime from\"D:/REact/01_first/interview/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:/REact/01_first/interview/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{profileAPI}from\"../api/profile-api\";var initialState={posts:[{id:1,message:'Hi, how are you?',likesCount:12},{id:2,message:'It\\'s my first post',likesCount:11},{id:3,message:'Blabla',likesCount:11},{id:4,message:'Dada',likesCount:11}],profile:null,status:\"\",isFetchingSave:false};var profileReducer=function profileReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case'ADD-POST':{var newPost={id:5,message:action.newPostText,likesCount:0};return _objectSpread(_objectSpread({},state),{},{posts:[].concat(_toConsumableArray(state.posts),[newPost])});}case'SET_STATUS':{return _objectSpread(_objectSpread({},state),{},{status:action.status});}case'SET_USER_PROFILE':{return _objectSpread(_objectSpread({},state),{},{profile:action.profile});}case'DELETE_POST':return _objectSpread(_objectSpread({},state),{},{posts:state.posts.filter(function(p){return p.id!=action.postId;})});case\"SAVE_PHOTO_SUCCESS\":return _objectSpread(_objectSpread({},state),{},{profile:_objectSpread(_objectSpread({},state.profile),{},{photos:action.photos})});case\"TOGGLE_IS_FETCHING\":return _objectSpread(_objectSpread({},state),{},{isFetchingSave:action.isFetching});default:return state;}};export var actions={addPostActionCreator:function addPostActionCreator(newPostText){return{type:'ADD-POST',newPostText:newPostText};},setUserProfile:function setUserProfile(profile){return{type:'SET_USER_PROFILE',profile:profile};},setStatus:function setStatus(status){return{type:'SET_STATUS',status:status};},deletePost:function deletePost(postId){return{type:'DELETE_POST',postId:postId};},savePhotoSuccess:function savePhotoSuccess(photos){return{type:\"SAVE_PHOTO_SUCCESS\",photos:photos};},isFetchingTogle:function isFetchingTogle(isFetching){return{type:\"TOGGLE_IS_FETCHING\",isFetching:isFetching};}};export var getUserProfile=function getUserProfile(userId){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return profileAPI.getProfile(userId);case 2:data=_context.sent;dispatch(actions.setUserProfile(data));case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};export var getStatus=function getStatus(userId){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return profileAPI.getStatus(userId);case 2:data=_context2.sent;dispatch(actions.setStatus(data));case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var updateStatus=function updateStatus(status){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return profileAPI.updateStatus(status);case 2:data=_context3.sent;if(data.resultCode===0){dispatch(actions.setStatus(status));}case 4:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();};export var savePhoto=function savePhoto(file){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:dispatch(actions.isFetchingTogle(true));_context4.next=3;return profileAPI.savePhoto(file);case 3:data=_context4.sent;if(data.resultCode===0){dispatch(actions.savePhotoSuccess(data.data.photos));}dispatch(actions.isFetchingTogle(false));case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();};export var saveProfile=function saveProfile(profile){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch,getState){var userId,data;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:userId=getState().auth.userId;_context5.next=3;return profileAPI.saveProfile(profile);case 3:data=_context5.sent;if(!(data.resultCode===0)){_context5.next=10;break;}if(!(userId!=null)){_context5.next=9;break;}dispatch(getUserProfile(userId));_context5.next=10;break;case 9:throw new Error(\"userId null\");case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x5,_x6){return _ref5.apply(this,arguments);};}();};export default profileReducer;","map":{"version":3,"sources":["D:/REact/01_first/interview/src/redux/profile-reducer.ts"],"names":["profileAPI","initialState","posts","id","message","likesCount","profile","status","isFetchingSave","profileReducer","state","action","type","newPost","newPostText","filter","p","postId","photos","isFetching","actions","addPostActionCreator","setUserProfile","setStatus","deletePost","savePhotoSuccess","isFetchingTogle","getUserProfile","userId","dispatch","getProfile","data","getStatus","updateStatus","resultCode","savePhoto","file","saveProfile","getState","auth","Error"],"mappings":"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","sourcesContent":["import {PhotosType, PostType, ProfileType} from \"../Types/types\";\r\nimport {ThunkAction} from \"redux-thunk\";\r\nimport {AppStateType, BaseThunkType, InferActionsTypes} from \"./redux-store\";\r\nimport {Dispatch} from \"redux\";\r\nimport {usersAPI} from \"../api/users-api\";\r\nimport {profileAPI} from \"../api/profile-api\";\r\n\r\n\r\n\r\n\r\nlet initialState = {\r\n    posts: [\r\n        {id: 1, message: 'Hi, how are you?', likesCount: 12},\r\n        {id: 2, message: 'It\\'s my first post', likesCount: 11},\r\n        {id: 3, message: 'Blabla', likesCount: 11},\r\n        {id: 4, message: 'Dada', likesCount: 11}\r\n    ] as Array<PostType>,\r\n    profile: null as ProfileType | null,\r\n    status: \"\",\r\n    isFetchingSave: false as boolean\r\n};\r\n\r\n\r\n\r\nconst profileReducer = (state = initialState, action:ActionsTypes):initialStateType => {\r\n\r\n    switch (action.type) {\r\n        case 'ADD-POST': {\r\n            let newPost = {\r\n                id: 5,\r\n                message: action.newPostText,\r\n                likesCount: 0\r\n            };\r\n            return {\r\n                ...state,\r\n                posts: [...state.posts, newPost],\r\n            };\r\n        }\r\n        case 'SET_STATUS': {\r\n            return {\r\n                ...state,\r\n                status: action.status\r\n            }\r\n        }\r\n        case 'SET_USER_PROFILE': {\r\n            return {...state, profile: action.profile}\r\n        }\r\n\r\n        case 'DELETE_POST':\r\n            return {...state, posts: state.posts.filter(p => p.id != action.postId)}\r\n        case \"SAVE_PHOTO_SUCCESS\":\r\n            return {...state, profile: {...state.profile, photos: action.photos}as ProfileType }\r\n        case \"TOGGLE_IS_FETCHING\":\r\n            return {...state, isFetchingSave: action.isFetching}\r\n        default:\r\n            return state;\r\n    }\r\n}\r\n\r\nexport  const  actions = {\r\n     addPostActionCreator:(newPostText:string) => ({type: 'ADD-POST', newPostText})as const,\r\n     setUserProfile: (profile:ProfileType) => ({type: 'SET_USER_PROFILE', profile})as const,\r\n     setStatus :(status:string) => ({type: 'SET_STATUS', status})as const,\r\n     deletePost: (postId:number) => ({type: 'DELETE_POST', postId})as const,\r\n     savePhotoSuccess: (photos:PhotosType) => ({type: \"SAVE_PHOTO_SUCCESS\", photos})as const,\r\n     isFetchingTogle: (isFetching:boolean) =>({type: \"TOGGLE_IS_FETCHING\" , isFetching }) as const,\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport const getUserProfile = (userId:number):ThunkType => async (dispatch) => {\r\n    const data = await profileAPI.getProfile(userId);\r\n    dispatch(actions.setUserProfile(data));\r\n}\r\n\r\nexport const getStatus = (userId:number):ThunkType => async (dispatch) => {\r\n    let data = await profileAPI.getStatus(userId);\r\n    dispatch(actions.setStatus(data));\r\n}\r\n\r\nexport const updateStatus = (status:string):ThunkType => async (dispatch) => {\r\n    let data = await profileAPI.updateStatus(status);\r\n\r\n    if (data.resultCode === 0) {\r\n        dispatch(actions.setStatus(status));\r\n    }\r\n}\r\nexport const savePhoto = (file:File):ThunkType => async (dispatch)=>{\r\n    dispatch(actions.isFetchingTogle(true))\r\n    let data = await profileAPI.savePhoto(file);\r\n\r\n    if (data.resultCode === 0) {\r\n        dispatch(actions.savePhotoSuccess(data.data.photos));\r\n    }\r\n    dispatch(actions.isFetchingTogle(false))\r\n}\r\n\r\nexport const saveProfile = (profile:ProfileType):ThunkType => async (dispatch,getState)=>{\r\n    const userId = getState().auth.userId;\r\n    let data = await profileAPI.saveProfile(profile);\r\n    if (data.resultCode === 0) {\r\n        if (userId !=null){dispatch(getUserProfile(userId))}\r\n        else {\r\n            throw new Error(\"userId null\")\r\n        }\r\n\r\n    }\r\n\r\n\r\n}\r\nexport default profileReducer;\r\n\r\nexport type initialStateType = typeof initialState\r\ntype ActionsTypes = InferActionsTypes<typeof  actions>\r\ntype ThunkType = BaseThunkType<ActionsTypes>"]},"metadata":{},"sourceType":"module"}